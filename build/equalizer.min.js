(()=>{var Z=Object.defineProperty;var $=(i,e,t)=>e in i?Z(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var c=(i,e,t)=>($(i,typeof e!="symbol"?e+"":e,t),t),z=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var h=(i,e,t)=>(z(i,e,"read from private field"),t?t.call(i):e.get(i)),w=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},y=(i,e,t,r)=>(z(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t);var J=(i,e,t)=>(z(i,e,"access private method"),t);function N(i,e,t){return Math.min(Math.max(i,e),t)}function O(i){if(arguments.length<2)return i;for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)typeof i[r]=="undefined"&&(i[r]=t[r])}return i}function W(i){if(arguments.length<2)return i;for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)i[r]=t[r]}return i}function q(i,e){for(;i<0;)i+=e;return i%e}var K=function(i){return i},C,L;try{C=AudioContext||webkitAudioContext,L=!!C}catch(i){C=null,L=!1}function _(i,e){return new Promise(function(t,r){var a=new XMLHttpRequest;a.open("GET",i,!0),a.responseType="arraybuffer",a.onerror=r,a.onload=function(){t({data:a.response,callback:e})},a.send()})}function Q({data:i,callback:e}){return new Promise(function(t,r){var a=function(o){t(o),e&&e(o)};T.ctx.decodeAudioData(i,a,r)})}var A,M,E,P,d,D,b,l=class{constructor(e,t,r){w(this,D);w(this,A,!1);w(this,M,1);w(this,E,1);w(this,P,0);w(this,d,0);c(this,"playing",!1);c(this,"filter",null);c(this,"gain",null);c(this,"src",null);var a=this;switch(r?l.ctx=r:l.ctx=new C,typeof e){case"string":this.src=e,_(e,o).then(Q);break;case"object":Q({data:e,callback:o});break}function o(f){a.buffer=f,a.gain=a.filter=l.ctx.createGain(),a.gain.connect(l.ctx.destination),a.gain.gain.value=Math.max(Math.min(h(a,M),1),0),t&&t(this)}}applyFilter(e){return this.filter&&this.filter!==this.gain&&this.filter.disconnect(this.gain),this.filter=e,this.gain.connect(this.filter),this}play(e){var t=O(e||{},{time:l.ctx.currentTime,loop:this._loop,offset:this._offset,duration:this.buffer.duration-this._offset});return l.ctx&&/suspended/i.test(l.ctx.state)&&l.ctx.resume(),this.source&&this.stop(),y(this,P,t.time),y(this,A,t.loop),this.playing=!0,this.source=l.ctx.createBufferSource(),this.source.onended=J(this,D,b),this.source.buffer=this.buffer,this.source.loop=t.loop,this.source.playbackRate.value=h(this,E),this.source.connect(this.filter),this.source.start?this.source.start(t.time,t.offset):this.source.noteOn&&this.source.noteOn(t.time,t.offset),this}pause(e){if(!this.source||!this.playing)return this;var t=O(e||{},{time:l.ctx.currentTime});this.source.onended=K,this.source.stop?this.source.stop(t.time):this.source.noteOff&&this.source.noteOff(t.time),this.playing=!1;var r=l.ctx.currentTime;return t.time!="undefined"&&(r=t.time),y(this,d,r-h(this,P)+(h(this,d)||0)),h(this,A)?y(this,d,Math.max(h(this,d),0)%this.buffer.duration):y(this,d,Math.min(Math.max(h(this,d),0),this.buffer.duration)),this}stop(e){if(!this.source||!this.playing)return this;var t=O(e||{},{time:l.ctx.currentTime});return this.source.onended=K,this.source.stop?this.source.stop(t.time):this.source.noteOff&&this.source.noteOff(t.time),this.playing=!1,y(this,d,0),this}get volume(){return h(this,M)}set volume(e){y(this,M,e),this.gain&&(this.gain.gain.value=Math.max(Math.min(h(this,M),1),0))}get speed(){return h(this,E)}set speed(e){y(this,E,e),this.playing&&this.play()}get currentTime(){return this.playing?(l.ctx.currentTime-h(this,P)+h(this,d))*h(this,E):h(this,d)}set currentTime(e){var t;if(!this.buffer)return this;h(this,A)?t=Math.max(e,0)%this.buffer.duration:t=Math.min(Math.max(e,0),this.buffer.duration),y(this,d,t),this.playing&&this.play()}get millis(){return Math.floor(this.currentTime*1e3)}get duration(){return this.buffer?this.buffer.duration:0}},T=l;A=new WeakMap,M=new WeakMap,E=new WeakMap,P=new WeakMap,d=new WeakMap,D=new WeakSet,b=function(){this.playing=!1},c(T,"has",L),c(T,"ctx",null);var I=class{domElement;ctx;constructor(e,t){this.domElement=document.createElement("canvas"),this.domElement.width=e,this.domElement.height=t,this.ctx=this.domElement.getContext("2d"),this.children=[]}get width(){return this.domElement.width}get height(){return this.domElement.height}add(){for(var e=0;e<arguments.length;e++){var t=arguments[e],r=this.children.indexOf(t);r<0?this.children.push(t):(this.children.splice(r,1),this.children.push(t))}return this}remove(){for(var e=0;e<arguments.length;e++){var t=arguments[e],r=this.children.indexOf(t);r>=0&&this.children.splice(r,1)}return this}appendTo(e){return e.appendChild(this.domElement),this}clear(){return this.ctx.clearRect(0,0,this.domElement.width,this.domElement.height),this}render(){for(var e=0;e<this.children.length;e++)this.children[e].render(this.ctx);return this}},F=class{x=0;y=0;value=0;sum=0;constructor(e,t){this.x=e,this.y=t}},B=class{fill="#fff";linewidth=1;stroke="#000";opacity=1;updated=!1;position;scale=1;constructor(){this.position=new F}noStroke(){return this.stroke="transparent",this}noFill(){return this.fill="transparent",this}render(e){e.save(),e.fillStyle=this.fill,e.lineWidth=this.linewidth,e.strokeStyle=this.stroke,e.globalAlpha=this.opacity}},R=class extends B{x1=0;y1=0;x2=0;y2=0;value=0;constructor(e,t,r,a){super();this.x1=e,this.y1=t,this.x2=r,this.y2=a}render(e){return super.render(e),e.beginPath(),e.moveTo(this.x1,this.y1),e.lineTo(this.x2,this.y2),e.fill(),e.stroke(),e.restore(),this}},U=class extends B{x=0;y=0;r=0;constructor(e,t,r){super();this.x=e,this.y=t,this.r=r}render(e){return super.render(e),e.beginPath(),e.arc(this.x,this.y,this.r*this.scale,0,Math.PI*2),e.fill(),e.stroke(),e.restore(),this}},j=class extends B{vertices;index=0;constructor(e){super();this.vertices=e}render(e){super.render(e),e.beginPath();for(var t=0;t<this.vertices.length;t++){var r=this.vertices[t];t===0?e.moveTo(r.x,r.y):e.lineTo(r.x,r.y)}e.fill(),e.stroke(),e.restore()}};var v={eee:"#eee",ccc:"#ccc",bbb:"#bbb","888":"#888",black:"black",green:"rgb(100, 255, 100)",blue:"rgb(50, 150, 255)",purple:"rgb(150, 50, 255)",pink:"rgb(255, 100, 100)",red:"rgb(255, 50, 50)",orange:"orange",gold:"rgb(255, 150, 50)",white:"white"},V={font:{family:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',size:11,fill:v["888"],leading:20,weight:500},classic:{display:"block",position:"relative",background:"transparent",padding:20+"px"},recording:{position:"absolute",borderRadius:"50%",top:10+"px",left:"50%",width:8+"px",height:8+"px",marginLeft:-4+"px",marginTop:-4+"px",cursor:"pointer",background:v.ccc,content:""}};var u=class{analyser;domElement;nodes;renderer;bands;average;constructor(e,t,r,a){this.ctx=e||T.ctx,this.nodes=[],this.analyser=this.ctx.createAnalyser(),this.analyser.connect(this.ctx.destination),this.analyser.fftSize=a||this.analyser.frequencyBinCount,this.analyser.data=new Uint8Array(this.analyser.frequencyBinCount),this.domElement=document.createElement("div"),this.domElement.classList.add("equalizer"),this.renderer=new I(t||200,r||100).appendTo(this.domElement),W(this.renderer.domElement.style,V.classic);var o=[];this.bands=[];for(var f=0;f<u.Resolution;f++){var k=(f+.5)/u.Resolution,p=k*this.renderer.width,n=new R(p,0,p,0);n.value=0,n.linewidth=this.renderer.width/u.Resolution*.85,n.stroke=v.bbb,n.noFill(),n.opacity=.5,n.peak=new R(p-n.linewidth/2,0,p+n.linewidth/2,0),n.peak.value=0,n.peak.updated=!1,n.peak.stroke=v["888"],n.peak.noFill(),n.peak.linewidth=2,n.beat=new U(p,this.renderer.height*.125,2),n.beat.noStroke(),n.beat.fill=v.blue,n.direction=new R(p-n.linewidth/2,0,p+n.linewidth/2,0),n.direction.value=0,n.direction.stroke=v.red,n.direction.noFill(),n.direction.linewidth=2;var g=new F(p,0);g.sum=0,o.push(g),g.outlier=new U(0,0,1),g.outlier.noStroke(),g.outlier.fill=v.purple,this.bands.push(n)}this.average=new j(o),this.average.stroke=v.gold,this.average.opacity=.85,this.average.linewidth=1,this.average.noFill(),this.average.index=1}appendTo(e){return e.appendChild(this.domElement),this}load(e,t){return new Promise(function(r,a){var o=this,f=new XMLHttpRequest;f.open("GET",e,!0),f.onerror=a,f.onload=function(){var k=JSON.parse(f.response);o.analyzed=k,t&&t(),r(o.analyzed)},f.send()})}add(e){return this.nodes.indexOf(e)<0&&(this.nodes.push(e),e.connect(this.analyser)),this}remove(e){var t=this.nodes.indexOf(e);return t>=0?this.nodes.splice(t,1):null}update(e,t){if(this.analyzed){var r=Math.floor(e*this.analyzed.frameRate),a=this.analyzed.samples[r];a?this.analyser.data=Uint8Array.from(a):this.analyzer.data=new Uint8Array(this.analyzed.resolution)}else this.analyser.getByteFrequencyData(this.analyser.data);var o=this.renderer.height*.75,f=this.analyser.data.length/this.bands.length,k=0,p=Math.floor(f);this.renderer.clear();for(var n=0,g=0;n<this.analyser.data.length;n++){var Y=q(Math.floor(n-p/2),p);if(k+=N(this.analyser.data[n],0,255),Y===0){var ee=g/this.bands.length,s=this.bands[g],te=s.value,G=s.peak.value,H,X,S,m;s.value=k/p,s.value>s.peak.value?(s.peak.value=s.value,s.peak.updated=!0):(s.peak.value-=s.peak.value*u.Drag,s.peak.updated=!1),H=s.direction.value,s.direction.value=s.peak.value-G<-u.Precision?-1:s.peak.value-G<=u.Precision?0:1,X=H!==s.direction.value,X&&s.direction.value>0?(s.beat.scale=3,s.beat.updated=!0):(s.beat.scale+=(1-s.beat.scale)*u.Drift,s.beat.updated=!1),s.direction.stroke=s.direction.value<=0?v.pink:v.green,S=this.renderer.height-o*(s.value/u.Amplitude),s.y1=this.renderer.height,s.y2=Math.min(S,this.renderer.height-2),S=this.renderer.height-o*(s.peak.value/u.Amplitude),s.peak.y1=s.peak.y2=S,m=this.average.vertices[g],m.sum+=s.value,m.value=m.sum/this.average.index,m.y=this.renderer.height-o*m.value/u.Amplitude,Math.abs(s.value-m.value)>u.Amplitude*u.Threshold?(m.outlier.scale=2,m.outlier.updated=!0):(m.outlier.scale+=(1-m.outlier.scale)*u.Drift,m.outlier.updated=!1),s.render(this.renderer.ctx),s.peak.render(this.renderer.ctx),s.beat.render(this.renderer.ctx),s.direction.render(this.renderer.ctx),k=0,g++}}return this.average.render(this.renderer.ctx),this.analyzed||this.analyser.getByteTimeDomainData(this.analyser.data),this.average.index++,this}reset(){for(var e=0;e<this.average.vertices.length;e++){var t=this.average.vertices[e];t.sum=0,t.value=0,t.y=this.renderer.height}return this.average.index=1,this}},x=u;c(x,"Precision",0),c(x,"Resolution",16),c(x,"Drag",.005),c(x,"Drift",.33),c(x,"Amplitude",255),c(x,"Threshold",.25);})();
