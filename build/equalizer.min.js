(()=>{var Y=Object.defineProperty;var Z=(i,e,t)=>e in i?Y(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var d=(i,e,t)=>(Z(i,typeof e!="symbol"?e+"":e,t),t),U=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var o=(i,e,t)=>(U(i,e,"read from private field"),t?t.call(i):e.get(i)),k=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},y=(i,e,t,r)=>(U(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t);var H=(i,e,t)=>(U(i,e,"access private method"),t);function X(i,e,t){return Math.min(Math.max(i,e),t)}function O(i){if(arguments.length<2)return i;for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)typeof i[r]=="undefined"&&(i[r]=t[r])}return i}function J(i){if(arguments.length<2)return i;for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)i[r]=t[r]}return i}function N(i,e){for(;i<0;)i+=e;return i%e}var W=function(i){return i},q=window.AudioContext||window.webkitAudioContext,b=!!q;function _(i,e){return new Promise(function(t,r){var a=new XMLHttpRequest;a.open("GET",i,!0),a.responseType="arraybuffer",a.onerror=r,a.onload=function(){t({data:a.response,callback:e})},a.send()})}function K({data:i,callback:e}){return new Promise(function(t,r){var a=function(h){t(h),e&&e(h)};x.ctx.decodeAudioData(i,a,r)})}var A,T,M,E,f,C,$,l=class{constructor(e,t,r){k(this,C);k(this,A,!1);k(this,T,1);k(this,M,1);k(this,E,0);k(this,f,0);d(this,"playing",!1);d(this,"filter",null);d(this,"gain",null);d(this,"src",null);var a=this;switch(r?l.ctx=r:l.ctx=new q,typeof e){case"string":this.src=e,_(e,h).then(K);break;case"object":K({data:e,callback:h});break}function h(m){a.buffer=m,a.gain=a.filter=l.ctx.createGain(),a.gain.connect(l.ctx.destination),a.gain.gain.value=Math.max(Math.min(o(a,T),1),0),t&&t(this)}}applyFilter(e){return this.filter&&this.filter!==this.gain&&this.filter.disconnect(this.gain),this.filter=e,this.gain.connect(this.filter),this}play(e){var t=O(e||{},{time:l.ctx.currentTime,loop:this._loop,offset:this._offset,duration:this.buffer.duration-this._offset});return l.ctx&&/suspended/i.test(l.ctx.state)&&l.ctx.resume(),this.source&&this.stop(),y(this,E,t.time),y(this,A,t.loop),this.playing=!0,this.source=l.ctx.createBufferSource(),this.source.onended=H(this,C,$),this.source.buffer=this.buffer,this.source.loop=t.loop,this.source.playbackRate.value=o(this,M),this.source.connect(this.filter),this.source.start?this.source.start(t.time,t.offset):this.source.noteOn&&this.source.noteOn(t.time,t.offset),this}pause(e){if(!this.source||!this.playing)return this;var t=O(e||{},{time:l.ctx.currentTime});this.source.onended=W,this.source.stop?this.source.stop(t.time):this.source.noteOff&&this.source.noteOff(t.time),this.playing=!1;var r=l.ctx.currentTime;return t.time!="undefined"&&(r=t.time),y(this,f,r-o(this,E)+(o(this,f)||0)),o(this,A)?y(this,f,Math.max(o(this,f),0)%this.buffer.duration):y(this,f,Math.min(Math.max(o(this,f),0),this.buffer.duration)),this}stop(e){if(!this.source||!this.playing)return this;var t=O(e||{},{time:l.ctx.currentTime});return this.source.onended=W,this.source.stop?this.source.stop(t.time):this.source.noteOff&&this.source.noteOff(t.time),this.playing=!1,y(this,f,0),this}get volume(){return o(this,T)}set volume(e){y(this,T,e),this.gain&&(this.gain.gain.value=Math.max(Math.min(o(this,T),1),0))}get speed(){return o(this,M)}set speed(e){y(this,M,e),this.playing&&this.play()}get currentTime(){return this.playing?(l.ctx.currentTime-o(this,E)+o(this,f))*o(this,M):o(this,f)}set currentTime(e){var t;if(!this.buffer)return this;o(this,A)?t=Math.max(e,0)%this.buffer.duration:t=Math.min(Math.max(e,0),this.buffer.duration),y(this,f,t),this.playing&&this.play()}get millis(){return Math.floor(this.currentTime*1e3)}get duration(){return this.buffer?this.buffer.duration:0}},x=l;A=new WeakMap,T=new WeakMap,M=new WeakMap,E=new WeakMap,f=new WeakMap,C=new WeakSet,$=function(){this.playing=!1},d(x,"has",b),d(x,"ctx",null);var z=class{domElement;ctx;constructor(e,t){this.domElement=document.createElement("canvas"),this.domElement.width=e,this.domElement.height=t,this.ctx=this.domElement.getContext("2d"),this.children=[]}get width(){return this.domElement.width}get height(){return this.domElement.height}add(){for(var e=0;e<arguments.length;e++){var t=arguments[e],r=this.children.indexOf(t);r<0?this.children.push(t):(this.children.splice(r,1),this.children.push(t))}return this}remove(){for(var e=0;e<arguments.length;e++){var t=arguments[e],r=this.children.indexOf(t);r>=0&&this.children.splice(r,1)}return this}appendTo(e){return e.appendChild(this.domElement),this}clear(){return this.ctx.clearRect(0,0,this.domElement.width,this.domElement.height),this}render(){for(var e=0;e<this.children.length;e++)this.children[e].render(this.ctx);return this}},D=class{x=0;y=0;value=0;sum=0;constructor(e,t){this.x=e,this.y=t}},F=class{fill="#fff";linewidth=1;stroke="#000";opacity=1;updated=!1;position;scale=1;constructor(){this.position=new D}noStroke(){return this.stroke="transparent",this}noFill(){return this.fill="transparent",this}render(e){e.save(),e.fillStyle=this.fill,e.lineWidth=this.linewidth,e.strokeStyle=this.stroke,e.globalAlpha=this.opacity}},P=class extends F{x1=0;y1=0;x2=0;y2=0;value=0;constructor(e,t,r,a){super();this.x1=e,this.y1=t,this.x2=r,this.y2=a}render(e){return super.render(e),e.beginPath(),e.moveTo(this.x1,this.y1),e.lineTo(this.x2,this.y2),e.fill(),e.stroke(),e.restore(),this}},B=class extends F{x=0;y=0;r=0;constructor(e,t,r){super();this.x=e,this.y=t,this.r=r}render(e){return super.render(e),e.beginPath(),e.arc(this.x,this.y,this.r*this.scale,0,Math.PI*2),e.fill(),e.stroke(),e.restore(),this}},L=class extends F{vertices;index=0;constructor(e){super();this.vertices=e}render(e){super.render(e),e.beginPath();for(var t=0;t<this.vertices.length;t++){var r=this.vertices[t];t===0?e.moveTo(r.x,r.y):e.lineTo(r.x,r.y)}e.fill(),e.stroke(),e.restore()}};var v={eee:"#eee",ccc:"#ccc",bbb:"#bbb","888":"#888",black:"black",green:"rgb(100, 255, 100)",blue:"rgb(50, 150, 255)",purple:"rgb(150, 50, 255)",pink:"rgb(255, 100, 100)",red:"rgb(255, 50, 50)",orange:"orange",gold:"rgb(255, 150, 50)",white:"white"},Q={font:{family:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',size:11,fill:v["888"],leading:20,weight:500},classic:{display:"block",position:"relative",background:"transparent",padding:20+"px"},recording:{position:"absolute",borderRadius:"50%",top:10+"px",left:"50%",width:8+"px",height:8+"px",marginLeft:-4+"px",marginTop:-4+"px",cursor:"pointer",background:v.ccc,content:""}};var u=class{analyser;domElement;nodes;renderer;bands;average;constructor(e,t,r){this.nodes=[],this.analyser=x.ctx.createAnalyser(),this.analyser.connect(x.ctx.destination),this.analyser.fftSize=r||this.analyser.frequencyBinCount,this.analyser.data=new Uint8Array(this.analyser.frequencyBinCount),this.domElement=document.createElement("div"),this.domElement.classList.add("equalizer"),this.renderer=new z(e||200,t||100).appendTo(this.domElement),J(this.renderer.domElement.style,Q.classic);var a=[];this.bands=[];for(var h=0;h<u.Resolution;h++){var m=(h+.5)/u.Resolution,c=m*this.renderer.width,n=new P(c,0,c,0);n.value=0,n.linewidth=this.renderer.width/u.Resolution*.85,n.stroke=v.bbb,n.noFill(),n.opacity=.5,n.peak=new P(c-n.linewidth/2,0,c+n.linewidth/2,0),n.peak.value=0,n.peak.updated=!1,n.peak.stroke=v["888"],n.peak.noFill(),n.peak.linewidth=2,n.beat=new B(c,this.renderer.height*.125,2),n.beat.noStroke(),n.beat.fill=v.blue,n.direction=new P(c-n.linewidth/2,0,c+n.linewidth/2,0),n.direction.value=0,n.direction.stroke=v.red,n.direction.noFill(),n.direction.linewidth=2;var g=new D(c,0);g.sum=0,a.push(g),g.outlier=new B(0,0,1),g.outlier.noStroke(),g.outlier.fill=v.purple,this.bands.push(n)}this.average=new L(a),this.average.stroke=v.gold,this.average.opacity=.85,this.average.linewidth=1,this.average.noFill(),this.average.index=1}appendTo(e){return e.appendChild(this.domElement),this}load(e,t){return new Promise(function(r,a){var h=this,m=new XMLHttpRequest;m.open("GET",e,!0),m.onerror=a,m.onload=function(){var c=JSON.parse(m.response);h.analyzed=c,t&&t(),r(h.analyzed)},m.send()})}add(e){return this.nodes.indexOf(e)<0&&(this.nodes.push(e),e.connect(this.analyser)),this}remove(e){var t=this.nodes.indexOf(e);return t>=0?this.nodes.splice(t,1):null}update(e,t){if(this.analyzed){var r=Math.floor(e*this.analyzed.frameRate),a=this.analyzed.samples[r];a?this.analyser.data=Uint8Array.from(a):this.analyzer.data=new Uint8Array(this.analyzed.resolution)}else this.analyser.getByteFrequencyData(this.analyser.data);var h=this.renderer.height*.75,m=this.analyser.data.length/this.bands.length,c=0,n=Math.floor(m);this.renderer.clear();for(var g=0,R=0;g<this.analyser.data.length;g++){var V=N(Math.floor(g-n/2),n);if(c+=X(this.analyser.data[g],0,255),V===0){var ee=R/this.bands.length,s=this.bands[R],te=s.value,I=s.peak.value,j,G,S,p;s.value=c/n,s.value>s.peak.value?(s.peak.value=s.value,s.peak.updated=!0):(s.peak.value-=s.peak.value*u.Drag,s.peak.updated=!1),j=s.direction.value,s.direction.value=s.peak.value-I<-u.Precision?-1:s.peak.value-I<=u.Precision?0:1,G=j!==s.direction.value,G&&s.direction.value>0?(s.beat.scale=3,s.beat.updated=!0):(s.beat.scale+=(1-s.beat.scale)*u.Drift,s.beat.updated=!1),s.direction.stroke=s.direction.value<=0?v.pink:v.green,S=this.renderer.height-h*(s.value/u.Amplitude),s.y1=this.renderer.height,s.y2=Math.min(S,this.renderer.height-2),S=this.renderer.height-h*(s.peak.value/u.Amplitude),s.peak.y1=s.peak.y2=S,p=this.average.vertices[R],p.sum+=s.value,p.value=p.sum/this.average.index,p.y=this.renderer.height-h*p.value/u.Amplitude,Math.abs(s.value-p.value)>u.Amplitude*u.Threshold?(p.outlier.scale=2,p.outlier.updated=!0):(p.outlier.scale+=(1-p.outlier.scale)*u.Drift,p.outlier.updated=!1),s.render(this.renderer.ctx),s.peak.render(this.renderer.ctx),s.beat.render(this.renderer.ctx),s.direction.render(this.renderer.ctx),c=0,R++}}return this.average.render(this.renderer.ctx),this.analyzed||this.analyser.getByteTimeDomainData(this.analyser.data),this.average.index++,this}reset(){for(var e=0;e<this.average.vertices.length;e++){var t=this.average.vertices[e];t.sum=0,t.value=0,t.y=this.renderer.height}return this.average.index=1,this}},w=u;d(w,"Precision",0),d(w,"Resolution",16),d(w,"Drag",.005),d(w,"Drift",.33),d(w,"Amplitude",255),d(w,"Threshold",.25);})();
